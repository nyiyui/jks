{{ template "base.html" $ }}
{{ define "body" }}
<table>
  <tr>
    <th>Quick Title / Note</th>
    <th>Start</th>
    <th>End</th>
    <th>Location</th>
    <th>Actions</th>
  </tr>
{{ range $i, $a := .latest }}
  <tr>
    <td>
      {{ if eq "" $a.Note }}
      {{ $task := index $.tasks $i }}
      {{ $task.QuickTitle }}
      {{ else }}
      {{ $a.Note }}
      {{ end }}
    </td>
    <td>
      {{ $a.TimeStart.Local.Format "2006-01-02 Mon" }}
      {{ $a.TimeStart.Local.Format "15:04" }}
    </td>
    <td>
      {{ $a.TimeEnd.Local.Format "15:04" }}
    </td>
    <td>
      {{ if ne "" $a.Location }}
      {{ $a.Location }}
      {{ end }}
    </td>
    <td>
      {{ if ge $a.TimeEnd.Unix (sub now.Unix 86400) }}
      {{ if eq $i 0 }}
      <form action="/activity/{{ $a.ID }}/extend" method="post">
        <label>
          New End
          <input type="time" name="time_end" value="{{ now.Format "15:04" }}" />
        </label>
        <input type="submit" value="Extend" />
      </form>
      {{ else }}
      <form action="/activity/{{ $a.ID }}/resume" method="post">
        <label>
          Start
          <input type="time" name="time_start" value="{{ now.Format "15:04" }}" />
        </label>
        <label>
          End
          <input type="time" name="time_end" value="{{ now.Format "15:04" }}" />
        </label>
        <input type="submit" value="Duplicate" />
      </form>
      {{ end }}
      {{ end }}
    </td>
  </tr>
{{ end }}
</table>
{{ end }}
